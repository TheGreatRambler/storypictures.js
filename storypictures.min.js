/* Copyright TheGreatRambler 2018 */
(function(d,a){"function"===typeof define&&define.amd?define(["ROT"],a):"object"===typeof module&&module.exports?module.exports=a(require("ROT")):d.storypictures=a(d.ROT)})("undefined"!==typeof self?self:this,function(d){return function(a){function d(a,l){var m=[],h=0,b=document.createElement("canvas").getContext("2d");b.mozImageSmoothingEnabled=!1;b.webkitImageSmoothingEnabled=!1;b.msImageSmoothingEnabled=!1;b.imageSmoothingEnabled=!1;b.canvas.width=Math.round(k.width*a);b.canvas.height=Math.round(k.height*
a);b.drawImage(k,0,0,b.canvas.width,b.canvas.height);data32=new Uint32Array(b.getImageData(0,0,b.canvas.width,b.canvas.height).data.buffer);var e=new ArrayBuffer(4);var g=new Uint32Array(e);e=new Uint8Array(e);g[0]=3735928559;g=239==e[0]?!0:222==e[0]?!1:void 0;for(i=0;i<data32.length;i++){e=i%b.canvas.width;var c=i/b.canvas.width|0;e=e>=c?e*e+e+c:c*c+e;if(g){c=data32[i]&255;var d=data32[i]>>8&255;var n=data32[i]>>16&255;var f=data32[i]>>24&255}else c=data32[i]>>24&255,d=data32[i]>>16&255,n=data32[i]>>
8&255,f=data32[i]&255;l(c,d,n,f)?m[e]=!1:(h++,m[e]=!0)}return{pixels:m,spotsopen:h,width:b.canvas.width,height:b.canvas.height}}if(a.img instanceof HTMLImageElement){var k=document.createElement("canvas");k.width=a.img.width;k.height=a.img.height;var f=k.getContext("2d");f.drawImage(a.img,0,0)}else if(a.img instanceof CanvasRenderingContext2D)k=a.img.context,f=a.img;else throw new TypeError("Image must context or image element");a.story=a.story.replace(/(?:\r\n|\r|\n)/g,"");a.solidityFunc||(a.solidityFunc=
function(a,l,d,f){return 40>.2126*a+.7152*l+.0722*d?!0:!1});f=d(1,a.solidityFunc);f=1*Math.sqrt(a.story.length/(2*f.spotsopen));var p=d(f,a.solidityFunc);return function(a,d){function f(a,c){e?"[object Object]"===Object.prototype.toString.call(d[b])?d[b].c?h.draw(a,c,d[b].n,d[b].c):h.draw(a,c,d[b]):h.draw(a,c,d[b]):h.draw(a,c,d.charAt(b));b++}for(var h=new ROT.Display({width:2*a.width,height:a.height,forceSquareRatio:!1,fontSize:12,bg:"#FFFFFF",fg:"#000000"}),b=0,e=d.constructor===Array,g=0;g<a.height;g++)for(var c=
0;c<a.width;c++)a.pixels[c>=g?c*c+c+g:g*g+c]&&(f(2*c,g),f(2*c+1,g));return h._context}(d(Math.sqrt(a.story.length/(2*p.spotsopen))*f,a.solidityFunc),a.story)}});

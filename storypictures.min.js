/* Copyright TheGreatRambler 2018 */
(function(e,a){"function"===typeof define&&define.amd?define(["ROT"],a):"object"===typeof module&&module.exports?module.exports=a(require("ROT")):e.storypictures=a(e.ROT)})("undefined"!==typeof self?self:this,function(e){return function(a){function e(a,e){var k=[],f=0,b=document.createElement("canvas").getContext("2d");b.mozImageSmoothingEnabled=!1;b.webkitImageSmoothingEnabled=!1;b.msImageSmoothingEnabled=!1;b.imageSmoothingEnabled=!1;b.canvas.width=Math.round(g.width*a);b.canvas.height=Math.round(g.height*
a);b.drawImage(g,0,0,b.canvas.width,b.canvas.height);data32=new Uint32Array(b.getImageData(0,0,b.canvas.width,b.canvas.height).data.buffer);var c=new ArrayBuffer(4);var h=new Uint32Array(c);c=new Uint8Array(c);h[0]=3735928559;h=239==c[0]?!0:222==c[0]?!1:void 0;for(i=0;i<data32.length;i++){c=i%b.canvas.width;var d=i/b.canvas.width|0;c=c>=d?c*c+c+d:d*d+c;if(h){d=data32[i]&255;var l=data32[i]>>8&255;var m=data32[i]>>16&255;var n=data32[i]>>24&255}else d=data32[i]>>24&255,l=data32[i]>>16&255,m=data32[i]>>
8&255,n=data32[i]&255;e(d,l,m,n)?k[c]=!1:(f++,k[c]=!0)}return{pixels:k,spotsopen:f,width:b.canvas.width,height:b.canvas.height}}if(a.img instanceof HTMLImageElement){var g=document.createElement("canvas");g.width=a.img.width;g.height=a.img.height;var d=g.getContext("2d");d.drawImage(img,0,0)}else if(a.img instanceof CanvasRenderingContext2D)g=a.img.context,d=a.img;else throw new TypeError("Image must be canvas, context, or image element");a.solidityFunc||(a.solidityFunc=function(a,d,e,f){return 40>
.2126*a+.7152*d+.0722*e?!0:!1});d=e(1,a.solidityFunc);d=1*Math.sqrt(a.story.length/(2*d.spotsopen));var p=e(d,a.solidityFunc);(function(a,d){for(var e=new ROT.Display({width:2*a.width,height:a.height,forceSquareRatio:!1,fontSize:12,bg:"#FFFFFF",fg:"#000000"}),f=0,b=0;b<a.height;b++)for(var c=0;c<a.width;c++)a.pixels[c>=b?c*c+c+b:b*b+c]&&(e.draw(2*c,b,d.charAt(f)),f++,e.draw(2*c+1,b,d.charAt(f)),f++);return e._context})(e(Math.sqrt(a.story.length/(2*p.spotsopen))*d,a.solidityFunc),a.story)}});
